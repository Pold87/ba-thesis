<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Knowledge Engineering Tools for Planning in PDDL - Syntax Highlighting, Task Generation and Plan Visualization and Execution - an extensible framework</title>
<!-- 2014-03-14 Fri 00:20 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Volker Strobel" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../../css/bootstrap.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Knowledge Engineering Tools for Planning in PDDL - Syntax Highlighting, Task Generation and Plan Visualization and Execution - an extensible framework</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Introduction</a>
<ul>
<li><a href="#sec-1-1">1.1. Finding of the research topic</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Related Work</a>
<ul>
<li><a href="#sec-2-1">2.1. PDDL Studio</a></li>
<li><a href="#sec-2-2">2.2. PDDL Mode for Emacs</a></li>
<li><a href="#sec-2-3">2.3. itSIMPLE</a></li>
<li><a href="#sec-2-4">2.4. GIPO</a></li>
<li><a href="#sec-2-5">2.5. ModPlan</a></li>
<li><a href="#sec-2-6">2.6. VISPLAN</a></li>
<li><a href="#sec-2-7">2.7. Conclusion</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Planning Basics and PDDL</a>
<ul>
<li><a href="#sec-3-1">3.1. Domain File</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Define</a></li>
<li><a href="#sec-3-1-2">3.1.2. Requirements</a></li>
<li><a href="#sec-3-1-3">3.1.3. Types</a></li>
<li><a href="#sec-3-1-4">3.1.4. Actions</a></li>
<li><a href="#sec-3-1-5">3.1.5. Functions</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. Problem File</a></li>
<li><a href="#sec-3-3">3.3. Planning</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Software Engineering Tools for AI Planning</a>
<ul>
<li><a href="#sec-4-1">4.1. Statement of Problem</a></li>
<li><a href="#sec-4-2">4.2. Clojure Interface</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. Create</a></li>
<li><a href="#sec-4-2-2">4.2.2. Basics</a></li>
<li><a href="#sec-4-2-3">4.2.3. Functions</a></li>
<li><a href="#sec-4-2-4">4.2.4. Numerical Expressiveness</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. Syntax Highlighting and Code Snippets</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. Implementation and Customization</a></li>
<li><a href="#sec-4-3-2">4.3.2. Usage and Customization</a></li>
<li><a href="#sec-4-3-3">4.3.3. Use case</a></li>
<li><a href="#sec-4-3-4">4.3.4. Evaluation</a></li>
</ul>
</li>
<li><a href="#sec-4-4">4.4. Type Diagram Generator</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Analysis</a>
<ul>
<li><a href="#sec-5-1">5.1. Participants</a></li>
<li><a href="#sec-5-2">5.2. Material</a></li>
<li><a href="#sec-5-3">5.3. Design</a></li>
<li><a href="#sec-5-4">5.4. Procedure</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Conclusion and Outlook</a>
<ul>
<li><a href="#sec-6-1">6.1. Outlook</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Appendix</a></li>
</ul>
</div>
</div>
<div class="abstract">
<p>
Automated planning and scheduling is a key component of artificial
intelligent (AI) behavior. A planning language that is widely used for
AI task specifications is the Planning Domain Definition Language
(PDDL). The aim of this project was to develop tools that simplify the
extensive knowledge engineering effort required by PDDL and thus
facilitate the construction of planning domains. For this purpose, an
extensible interface between the programming language Clojure and PDDL
was developed, that supports knowledge engineers in developing PDDL
projects. A tool based on this interface visualizes the type hierarchy
in PDDL domains, allowing knowledge engineers to keep track of the
domain structure and others that may have to work with the domains to
understand them at a glance. As further implementation of this
interface, a tool that calculates the distances of objects within a
problem file to each other was created to show the extent of this tool
and to present a way of bypassing PDDL's limited modeling capacity.
Lastly, a plug-in for the code editor Sublime Text was implemented to
aid developers with efficiently creating new PDDL file, navigating
within the code and with finding and fixing mistakes. In order to test
the quality of the syntax highlighter and the type diagram generator,
a user study was conducted with inexperienced PDDL users that were
asked to develop domains with and without the tools and to
subsequently evaluate the tools in regard to their usefulness and
usability. Both the time on task, number of errors and a post
questionnaire were analyzed and it was found that… All tools developed
within the scope of this thesis are unique in some regard and they can
all be altered very easily to work with other editors and planning
languages. An auxiliary tool to transform PDDL code into Clojure code
that was needed for the latter two tools, could be relevant for future
works in the field, as there are many additional use cases such as…
</p>

<p>
<a href="https://www.ece.cmu.edu/~koopman/essays/abstract.html">https://www.ece.cmu.edu/~koopman/essays/abstract.html</a>
</p>

</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
Assume you are a monkey in a cage. There are some bananas dangling
from the ceiling and a bunch of boxes lying around on the ground. You
are hungry and those bananas look delicious, but you just cannot reach
them. To solve the problem at hand it is important that you figure out
that the boxes can be stacked on top of each other and that you can
then climb on top of the boxes and reach the bananas, i.e. you need to
come up with a sequence of actions that take you from your initial
state to your goal state. This famous experiment is described by
Wolfgang Köhler in his book \citetitle{kohler1924mentality} and became
known (in a similar form) in Artificial Intelligence (AI) research as
the <i>monkey and banana problem</i>. Importantly, with this experiment,
Köhler demonstrated that the monkeys did not acquire the solution by
trial and error, but rather that they actually understood the
environment enough to devise a plan only by contemplating the problem
in the context of their world. As can be seen from the scenario given
above, planning is a crucial component of problem-solving. However,
while monkeys and humans are able to create and continuously update
their mental models of the world thanks to sensors, AI implementations
are yet to fully master this skill (SOURCE! WHAT IS STILL MISSING?).
Thus, the most common and extensive approach to planning in AI to this
day is by means of knowledge engineering (KE). In KE, a human expert
that is familiar with the underlying syntax integrates world
information into a computer system \textcite{feigenbaum1983fifth}. In
automated planning, this is usually done using a planning language
applied in an editor. A standard Both the world and the problem are
modeled with the planning language and are then fed to the planning
software as inputs. The software produces the solution to the problem
in the form of a plan, that means a sequence of action, leading from
the initial state to the goal state as output. Naturally, the process
of creating these modeled worlds, from here on after called domains,
and problems is error-prone and time consuming. While it cannot be
denied that the planning systems are improving steadily as computer
processing times decrease and algorithms are altered to work even
better, the human factor in the knowledge engineering approach cannot
be ignored (SOURCE). Performances of planners are largely dependent on
the input they receive and the manner in which it is written (SOURCE).
Therefore, focusing on the usability of planning languages and hence
facilitating the knowledge engineering process is worthwhile. Although
recent PDDL extensions increased the expressiveness of PDDL and thus
allowed for real-world applications (SOURCE!!!), they also demand a
higher level of knowledge and attention on the part of the knowledge
engineer. Particularly during the first International Competition on
Knowledge Engineering for Planning and Scheduling in 2005, advances
were made in shifting the modelling process from a text-based to a
graphical programming environment. Even though such tools seem more
user-friendly at first, they also demonstrated considerable drawbacks
such as limited functionality, expenditure of time and editing
difficulty (SOURCE). Obviously, the usefulness of such tools depends
on the demands of the knowledge engineer. Yet, the question arises,
whether it is not better to develop tools that facilitate text-based
programming to such a degree that it is as easy to use as graphical
interfaces while still allowing the user full functionality and the
necessary insight into the code to edit it (Classification of Concrete
Textual Syntax Mapping Approaches - Nice Paper). As can be seen from
the two problems described above, tools that ensure greater usability
of planning language editors and thus help in producing standardized,
high-quality domains and problems that not only planners but also
other knowledge engineers can easily work with are greatly needed. The
main focus of this thesis is on the development of such handy tools
that support (and partially automate) the planning process. At first,
already existing planning tool are reviewed in order to put this
thesis in context. The body of this thesis consists of three parts.
The first part introduces the basics of planning and the PDDL syntax.
This is followed by the second part, which presents a extensible
interface between the programming language Clojure
\textcite{hickey2008clojure} and PDDL. Based on this interface, a
plug-in for the text and code editor Sublime Text (ST) was implemented
that consists of a type diagram generator and a distance calculator.
Furthermore, the development, application and customization of a
sophisticated syntax highlighter for ST will be presented. The third
part is devoted to the evaluation of the type diagram generator and
the syntax highlighter in terms of their usefulness and usability. As
means to this end, a small user study was conducted with subjects that
had no prior PDDL experience. The results and their implications will
be discussed before an outlook for future research and developments in
the field concludes this thesis (perhaps mention results and outlook
here).
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Finding of the research topic</h3>
<div class="outline-text-3" id="text-1-1">
<p>
During the research for this thesis, it turned out, that the tools for
writing and expanding extensive PDDL descriptions in a reasonable time
are limited, while tools for checking plans (\textcite{howey2004val} +
second topic, \textcite{glinsky2011visplan}) and applying PDDL
descriptions (broad range of planner)s, are far more matured. While
the original research interest was concentrated on possibilities and
limitations of artificial intelligence planning using PDDL, a focus
shift was performed, recognizing, that the main PDDL limitation is
still the <i>basic</i> modeling process, meaning that efficient modeling of
useful domains and problems <i>by hand</i> is hardly possible by the
existing tools (that's too hard!). Anymore, PDDL's general
representation ability is already limited through the missing support
of mathematical operations besides basic arithmetics. On this account,
a possibility for <i>extending</i> PDDL was searched and found in Clojure,
using the relatedness of both languages embellished by PDDL's
LISP-derived notation. In the course of the development of this
PDDL/Clojure interface between great potential was seen for
facilitating the PDDL design process and thereby push the acceptance
and usage of PDDL in real world models. The customizability and
extensibility of the ST editor as well as the broad variety of
build-in editing features, constituted a convenient basis for the
design of a development environment for PDDL. A large variety of
language-independent plug-ins exist and is constantly developed, like
package managers, git connection . This project focuses the 
A key concept for the development was the ease of application, so that
new users should be able to effectively use the majority of functions
intuitively within a short time.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Related Work</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> PDDL Studio</h3>
<div class="outline-text-3" id="text-2-1">
<p>
PDDL Studio \parencite{plch2012inspect} is an Integrated Development
Environment (IDE) for creating PDDL tasks (domains and problems) with
supporting editing features that are based on a PDDL parser, like
syntax highlighting, code collapsing and code completion. It provides
a sophisticated on the fly error detection, that splits errors in
syntax errors, semantic errors and errors found during parsing. The
code completion feature allows completion for standard PDDL constructs
and dynamic list completions, that were used in the current project
(TODO: technical terms!).
</p>

<p>
Tasks are organized into project, that means a project is composed of
a domain and associated problem(s).
</p>

<p>
An interface allows the integration of command line planners in order
to run and compare different planning software.
</p>

<p>
Furthermore it provides a XML Export/Import feature (i.e. XML-&gt;PDDL,
PDDL-&gt;XML) and further common editor features like a line counter,
bracket matcher and a auto-save feature.
</p>

<p>
that means syntax and semantic checking, syntax highlighting, code
completion and project management. While colors for highlighted code
can be customized, the background color of the tool is always white.
</p>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> PDDL Mode for Emacs</h3>
<div class="outline-text-3" id="text-2-2">
<p>
PDDL-mode is a major Emacs mode for browsing and editing PDDL 2.2
files. It supports syntax highlighting by basic pattern matching,
regardless of the current semantic, automatic indentation and
completions. Code snippets for the insertion of domains, problems and
actions are provided. A declaration menu shows all actions and
problems in the current PDDL file.
</p>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> itSIMPLE</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The itSIMPLE project is a tool that supports the knowledge engineer in
designing a PDDL domain by the use of UML diagrams. This approach is
reversed to the approach mentioned in this paper: while itSIMPLE
generates PDDL from UML, this paper generated UML from PDDL. 
</p>

<p>
itSIMPLE is able to import and separate elements of domain and
problems specified in a file. The itSIMPLE PDDL editor supports syntax
highlighting by keywords and variables. 
</p>

<p>
It also provides templates for PDDL constructs, like predicates,
actions, goals, initial definitions.
</p>

<p>
itSIMPLE focuses on the initial states of the design process. The
design environment is 
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> GIPO</h3>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> ModPlan</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Also see VEGA plan visulazation on the MODplan page
</p>
<ul class="org-ul">
<li>Very interesting: <a href="http://www.tzi.de/~edelkamp/modplan/">http://www.tzi.de/~edelkamp/modplan/</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> VISPLAN</h3>
</div>




<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> Conclusion</h3>
<div class="outline-text-3" id="text-2-7">
<p>
As it can be seen, there is need for an up-to-date, customizable, text
editor with PDDL support, that supports the current standard PDDL 3.1. 
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Planning Basics and PDDL</h2>
<div class="outline-text-2" id="text-3">
<p>
Introduction to planing:
<a href="http://books.google.de/books?id=eCj3cKC_3ikC&printsec=frontcover&dq=automated+planning&hl=en&sa=X&ei=3wgNU5fQIcHx4gSTsoDABA&redir_esc=y#v=onepage&q=automated%20planning&f=false">http://books.google.de/books?id=eCj3cKC_3ikC&printsec=frontcover&dq=automated+planning&hl=en&sa=X&ei=3wgNU5fQIcHx4gSTsoDABA&redir_esc=y#v=onepage&q=automated%20planning&f=false</a>
</p>

<p>
AI planning describes &#x2026;
</p>

<p>
A planner and use the generated solution file (<i>plan</i>).
</p>

<p>
PDDL was first described in PDDL-the planning domain definition
language (1998) and has been in constant development since then.
This thesis makes use of \textcite{pddl3.1} if not otherwise stated. 
</p>

<p>
PDDL planning task specifications are composed of two separate text files:
</p>

<ul class="org-ul">
<li>Domain file: description of general types, predicates, functions
and actions -&gt; uninstanciated problem independent
</li>
<li>Problem file: description of a concrete problem environment -&gt; instance speciﬁc
</li>
</ul>

<p>
This separation allows for an intuitive process of task modeling:
While general instances are described in the domain file, specific
instances of problems are created in the problem files.
</p>

<p>
<a href="../img/pddl-workflow.pdf">../img/pddl-workflow.pdf</a>
</p>

<p>
These two files shell be investigated further in the following
sections.
</p>
</div>


<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Domain File</h3>
<div class="outline-text-3" id="text-3-1">
<pre class="example">
(define (domain name)
    
  (:requirements :requirement1
                 :requirement2...)
  (:types subsubtype1 subsubtype2 – subtype1
          subtype1 – type1
          subtype2 – type2…
          type1 type2 …  - object)
  
  (:predicates (predicateName1 ?var1 – typeOfVar1)
               (predicateName2 ?var2 – typeOfVar2 ?var3 – typeOfVar3)
               ...)
     
  (:action actionName1
    :parameters (...)
    :precondition (...)
    :effect (...))
  
  (:action actionName2
    :parameters (...)
    :precondition (...)
    :effect (...))
    
...)
</pre>

<pre class="example">
</pre>


<p>
The domain file contains the frame for planning tasks and determines,
which types, predicates and actions are possible
</p>

<p>
Domain files have a strict format: All keyword arguments must appear
in the order specified in the manual (an argument may be omitted,
according to 1998, only the strict part requires this order) and
just one PDDL definition (of a domain, problem, etc.) may appear per
file (same here). \cite[6]{fox2003pddl2}.
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Define</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Every domain file starts with (define (domain &lt;domainName&gt;) &#x2026;) where,
&lt;domainName&gt; can be any string.
</p>
</div>
</div>
<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> Requirements</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
The requirements part is not a mandatory part of a PDDL domain file.
However, PDDL supports different "levels of expressivity", that means
subsets of PDDL features \textcite[1]{mcdermott1998pddl}. As most
planners only support a subset of PDDL the requirements part is useful
for determining if a planner is able to act on a given problem. They
are declared by the <code>(:requirements ...)</code> part. Some often used
requirements include <code>:strips</code> For a list of current requirement flags
and their meaning, see &#x2026; It should be mentioned, that almost no
planner supports every part of PDDL. And, additionally, the quality of
error messages is very diversified. While some simple state: error
occured, other list the problem and the line.
</p>
</div>
</div>
<div id="outline-container-sec-3-1-3" class="outline-4">
<h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span> Types</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
If order to be able to use types in a domain file, the
requirement :typing should be declared (TODO: is :adl enough?).
</p>

<p>
In order to assign categories to objects, PDDL allows for
type definitions. Like that, parameters in actions can be typed, as
well as arguments in predicates, functions [extra source!]. Later, in
the problem file, objects will be assigned to types, like objects to
classes in Object Orientated Programming (OOP). Adding to the
(:requirement &#x2026;) part of the file guarantees, that typing can be
correctly used. Strips (no types) vs ADL (types).
</p>
</div>
</div>
<div id="outline-container-sec-3-1-4" class="outline-4">
<h4 id="sec-3-1-4"><span class="section-number-4">3.1.4</span> Actions</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
PDDL 3.1 supports two types of actions: durative-action and the
'regular' action.
</p>
</div>
</div>
<div id="outline-container-sec-3-1-5" class="outline-4">
<h4 id="sec-3-1-5"><span class="section-number-4">3.1.5</span> Functions</h4>
<div class="outline-text-4" id="text-3-1-5">
<p>
Functions are not supported by many planners (source!) and, before
PDDL 3.1 they could only be modeled as 
</p>

<p>
It is notable that before PDDL 3.0 the keyword functors was used instead
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Problem File</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Problems are designed with respect to a domain. Domains usually have
multiple problems p01.pddl, p02.pddl, &#x2026; Problems declare the initial
world state and the goal state to be reached. They instantiate types,
in they way that they create objects 
</p>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Planning</h3>
<div class="outline-text-3" id="text-3-3">
<p>
A planning solution is a sequence of actions that lead from the
initial state to the goal state. PDDL itself does not declare any
uniform plan layout.
</p>

<p>
The input to the planning software is a domain and a belonging
problem, the output is usually a totally or partially ordered plan.
are software tools that Due to the yearly ICAPS, there is a broad
range of available planners. This thesis uses the planner SGPLAN<sub>6</sub>
\textcite{hsu2008sgplan}, a 'extensive' (in the sense of its
supporting features) planner for both temporal and non-temporal
planning problems.
</p>

<p>
An overview of different planners is given at
<a href="http://ipc.informatik.uni-freiburg.de/Planners">http://ipc.informatik.uni-freiburg.de/Planners</a>.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Software Engineering Tools for AI Planning</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Statement of Problem</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Writing and maintaining PDDL files can be time-consuming and
cumbersome \textcite{li2012translating}. So, the following development
tools shell support and facilitate the PDDL task design process and
reduce potential errors.
</p>

<p>
Below, methods are presented for
</p>

<dl class="org-dl">
<dt> Syntax Highlighting and Code Snippets </dt><dd>Environment for Editing
PDDL files
</dd>
<dt> Class Diagram Generator </dt><dd>The automation of the PDDL task design process. File
input and output and dynamic generation (design level)
</dd>
<dt> Human Planner Interaction </dt><dd>An interactive PDDL environment: speech synthesis and
recognition.
</dd>
<dt> Problem Generator </dt><dd>Mathematical limitations (design level)
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Clojure Interface</h3>
<div class="outline-text-3" id="text-4-2">
<p>
PDDL, as planning language modeling capabilities are limited, a
interface with a programming is handy a can reduce dramatically the
modeling time. In IPC, task generators are used write extensive domain
and problem files. As PDDL is used to create more and more complex domains
(SOURCE1, SOURCE2, SOURCE3, &#x2026;). 
</p>

<p>
While it seems to be reasonable to further extend PDDL's modeling
capability to at planning time instead of modeling time, a modeling
support tool as preprocessor is appropriate in any case
(<a href="http://orff.uc3m.es/bitstream/handle/10016/14914/proceedings-WS-IPC2012.pdf?sequence=1#page=47">http://orff.uc3m.es/bitstream/handle/10016/14914/proceedings-WS-IPC2012.pdf?sequence=1#page=47</a>)
</p>

<p>
As PDDL's syntax is inspired by LISP \parencite[64]{fox2003pddl2},
using a LISP dialect for the interface seems reasonable as file input
and output methods can use s-expressions instead of regular
expressions. This thesis uses Clojure \parencite{hickey2008clojure}, a
modern LISP dialect that runs on the Java Virtual Machine. So, PDDL
expressions can be extracted and written back in a similar manner, and
parts of PDDL files can be accessed in a natural way.
</p>

<p>
In this section, a general approach for generating PDDL
constructs, but also for reading in PDDL files, handling, using and
modifying the input, and generating PDDL files as output.
</p>
</div>

<div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> Create</h4>
</div>


<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> Basics</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
Through the higher-order filter method in Clojure, parts of PDDL files
can be easily extracted. Like that, one can extract parts of the file
and handle the constructs in a Clojure intern way.
</p>

<p>
As an example, the type handling will be represented here, but the
basic approach is similar for all PDDL constructs.
</p>

<p>
The here developed tools should be platform independent with a
development focus in UNIX/Linux systems, as most planners (source!)
run on Linux.
</p>
</div>
</div>
<div id="outline-container-sec-4-2-3" class="outline-4">
<h4 id="sec-4-2-3"><span class="section-number-4">4.2.3</span> Functions</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
As functions have a return value, the modeling possibilities
dramatically increase.
</p>
</div>
</div>

<div id="outline-container-sec-4-2-4" class="outline-4">
<h4 id="sec-4-2-4"><span class="section-number-4">4.2.4</span> Numerical Expressiveness</h4>
<div class="outline-text-4" id="text-4-2-4">
<p>
One might assume that the distance could be modeled as follows:
</p>

<pre class="example">
(durative action ...
...
  :duration (= ?duration (sqrt (coord-x )))
...
</pre>

<p>
However, PDDL does only support basic arithmetic operations (+, -, /, *).
</p>

<p>
An Euclidean distance function that uses the square root would be
convenient for distance modeling and measurement. However, PDDL 3.1
supports only four arithmetic operators (+, -, /, *). These
operators can be used in preconditions, effects
(normal/continuous/conditional) and durations.
\textcite{parkinson2012increasing} describe a workaround for this
drawback. By declaring an action `calculate-sqrt', they bypass the
lack of this function and rather write their own action that makes use
of the Babylonian root method.
</p>
</div>

<ol class="org-ol"><li>Alternative #1: Only sqrt exists<br  /><div class="outline-text-5" id="text-4-2-4-1">
<p>
Assuming that a function sqrt would actually exist, the duration could be modeled as follows:
</p>

<pre class="example">
:duration (= ?duration 
             (sqrt
              (+
               (*
                (- (pos-x (current-pos))
                   (pos-x ?goal))
                (- (pos-x (current-pos))
                   (pos-x ?goal)))
               (*
                (- (pos-y (current-pos))
                   (pos-y ?goal))
                (- (pos-y (current-pos))
                   (pos-y ?goal))))))
</pre>
</div>
</li>
<li>Alternative #2: sqrt and expt exist<br  /><div class="outline-text-5" id="text-4-2-4-2">
<p>
Assuming that a function sqrt would actually exist, the duration could be modeled as follows:
</p>
<pre class="example">
:duration (= ?duration 
             (sqrt
              (+
               (expt
                (- 
                 (pos-x (current-pos))
                 (pos-x ?goal)))
               (expt
                (- 
                 (pos-y (current-pos))
                 (pos-y ?goal))))))
</pre>
</div>
</li>

<li>Alternative #3: Calculate distance and hard code it, e.g. (distance table kitchen) = 5.9<br  /><div class="outline-text-5" id="text-4-2-4-3">
<ul class="org-ul">
<li>Distance Matrix
</li>
<li><a href="http://stackoverflow.com/questions/20654918/python-how-to-speed-up-calculation-of-distances-between-cities">http://stackoverflow.com/questions/20654918/python-how-to-speed-up-calculation-of-distances-between-cities</a>
</li>
<li>Scipy.spatial.distance (-&gt; Clojure?)
</li>
<li>Mention that the Taxicab geometry allows different ways that have an equal length
</li>
</ul>

<p>
Another alternative is to make use of an external helper and, instead
of calculating every entry of the distance matrix. the distance only
if needed, incorporate every possible combination of two locations.
This approach has certainly a major drawback: With an increasing
amount of locations, the number of combinations increases
exponentially. That means, if there are 100 locations, there will be
</p>
<div class="inlinetask">
<b>TODO: Calculate possibilities</b><br  />
nil</div>
<p>
&#x2026; . The native approach would be to iterate over the cities twice
and calculate only the half of the matrix (as it is symmetric, that
mean distance from A to B is the same as the distance from B to A).
</p>
</div>
</li>

<li>Alternative #4: Use the Manhattan distance<br  /><div class="outline-text-5" id="text-4-2-4-4">
<p>
Allowing the agent to move only vertically and horizontally would be
that one can use the so called Taxicab geometry (or Manhattan length)
as distance measurement.  In the Kitchen domain, this could be modeled
as follows:
</p>

<pre class="example">
% =&gt; Metric: reduce duration

% dKitchenware.pddl 
\begin{figure}[t]
\inputminted[mathescape, linenos, numbersep=5pt, frame=lines, framesep=2mm]
            {csharp}
            {Code/dKitchenware.pddl}
\caption{The basic kitchenware domain}
\end{figure}
\section
</pre>

<div class="inlinetask">
<b>TODO:</b><br  />
<p>
TODO Human Planner Interaction
</p>
</div>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Syntax Highlighting and Code Snippets</h3>
<div class="outline-text-3" id="text-4-3">
<p>
<a id="sec:syntax"></a>
</p>

<p>
Writing extensive domain and problem files is a cumbersome task:
longer files can get quickly confusing. Therefore, it is convenient to
have a tool that supports editing these files. Syntax highlighting
describes the feature of text editors of displaying code in different
colors and fonts according to the category of terms (source: Wiki). A
syntax highlighting plug-in for the text and source code editors
\textcite{sublimetext2} and \textcite{sublimetext3} is proposed and
transferred to the on-line text editor Ace are used to implement this
feature, as ST Syntax Highlighting files can easily be converted to
Ace Files. 
</p>

<p>
For Mac user, TextMate (TM) is very similar to ST and the syntax
highlighting file can be used there, too. Besides, the general
principles (e.g. regular expressions) outlined here, apply to most of
other editors as well. So, a Pygments extension was written, that
allows for syntax highlighting in \LaTeX documents.
</p>
</div>


<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> Implementation and Customization</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
ST syntax definitions are written in property lists in the XML format.
</p>

<p>
For the ease of creation, the PDDL syntax highlighter is is
implemented by the use of the ST plug-in \textcite{aaapackagedev}. So,
the definitions can be written in YAML in converted to Plist XML later
on. \textcite{aaapackagedev} is a ST plugin, that helps
to create, amongst others, ST packages, syntax definitions and
'snippets' (re-usable code). 
</p>

<p>
By means of Oniguruma regular expressions \parencite{kosako}, scopes
are defined, that determine the meaning of the PDDL code block. ST
themes highlight different parts of the code through by the use of
scopes. Scopes are defined by the use of regular expressions (regexes)
in a tmLanguage file. The scope naming conventions mentioned in the
\citetitle{textmate} are applied here. By the means of the name, the
colors are assigned. Different ST themes display different colors (not
all themes support all naming conventions).
</p>

<p>
The syntax highlighting is intended for PDDL 3.1, but is backward
compatible to previous version. It's based on the Backus-Naur Form
(BNF) descriptions, formulated in
\textcite{kovacs2011bnf,fox2003pddl2,mcdermott1998pddl}.
</p>

<p>
The pattern matching heuristic that is implemented by the use of
regular expressions is used for assigning scopes to the parts of the
file. As a result of PDDL's LISP-derived syntax, PDDL uses the
s-expression format for representing information (SOURCE!). So, the
semantic of a larger PDDL part (sexpr) can be recognized by a opening
parenthesis, followed by PDDL keyword and finally matched closing
parentheses (potentially containing further sexpr). These scopes
allow for a fragmentation of the PDDL files, so that constructs are
only highlighted, if they appear in the right section.
</p>

<p>
The YAML-tmlanguage file is organized into repositories, so that
expressions can be re-used in different scopes. This organization also
allows for a customization of the syntax highlighter. The default 
</p>

<p>
The first part of the PDDL.YAML-tmlanguage
describes the parts of the PDDL task that should be highlighted. By
removing (or commenting) include statements, the syntax highlighter is
adjustable the user's need.
</p>



<div id="Screenshot-in-Sublime-Text-3" class="figure">
<p><img src="file:///home/pold/Pictures/ba.png" alt="ba.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> Usage and Customization</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
New PDDL projects can be generated by invoking the following command:
</p>
<div class="org-src-container">

<pre class="src src-bash">$ java -jar path/to/pddl.jar new NAME
</pre>
</div>
<p>
This will create a new structured project folder, consisting of a
domain and problem file with basic skeletons, a domain and problem
folder for offline version control and a png and dot folder for the
generated dot language and png type diagrams respectively. 
</p>

<p>
After invoking pddl.jar twice with 
</p>


<p>
To enable syntax highlighting and code snippets in ST, the files of
this repository have to be placed in the ST packages folder
(<a href="http://www.sublimetext.com/docs/3/packages.html">http://www.sublimetext.com/docs/3/packages.html</a>). Following, the
features can be activated by changing ST's syntax to PDDL
(<code>View-&gt;Syntax-&gt;PDDL</code>).
</p>




<p>
By using ST as editor, language independent ST features are supported,
like auto completion of words already used in this file, code folding
and column selection, described in the Sublime Text 2 Documentation.
</p>



<p>
The PDDL.YAML-tmlanguage file is split in two parts:
</p>

<p>
By default, all scopes are included.
</p>
</div>
</div>

<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3"><span class="section-number-4">4.3.3</span> Use case</h4>
<div class="outline-text-4" id="text-4-3-3">
<p>
Following, a small use case will be presented, that should represent a
typical work flow using the tools presented in this paper.
</p>
</div>

<ol class="org-ol"><li>Initial Situation (Domain)<br  /><div class="outline-text-5" id="text-4-3-3-1">
<p>
Our world consists of two types of persons: hackers and non-hackers.
Hackers can be further divided into <i>white hats</i> (seeking
vulnerabilities on behalf of the system owner), <i>black hats</i>
(compromise security holes without permission) and <i>gray hats</i>
(sometimes act legally, other times not). <i>Software</i> can be
<i>application</i> software, <i>system</i> software or programming <i>tools</i>.
System software can be further divided into drivers and operating
systems. A hacker must not be hungry (and in that case need some needs
some pizza) in order to exploit vulnerable software.
</p>
</div>
</li>
<li>Problem<br  /><div class="outline-text-5" id="text-4-3-3-2">
<p>
<i>Gary</i> is a <i>hungry</i> <i>white-hat</i> hacker who should exploit Gisela's
<i>application</i> software <i>MysteriousTexMexMix</i> on behalf of her. In order to
plan the sequence of required actions, Gary uses the tools presented
in this paper and the planning software SGPlan<sub>6</sub>.
</p>
</div>
</li>
<li>Workflow<br  /><div class="outline-text-5" id="text-4-3-3-3">
<p>
Gary creates a new PDDL project using the command line, to this end he
types
</p>
<div class="org-src-container">

<pre class="src src-bash">$ java -jar pddl.jar new hacker-world
</pre>
</div>
<p>
changes into that directory 
</p>
<div class="org-src-container">

<pre class="src src-bash">$ cd bulb-world
</pre>
</div>
<p>
and renames the file domain.pddl to 
</p>
<div class="org-src-container">

<pre class="src src-bash">$ mv domain.pddl garys-hacker-world.pddl
</pre>
</div>

<p>
To get an overview over the world structure, Gary doodles a quick type
diagram with the freely available graph editor and layout program yEd
(yFiles software, Tübingen, Germany) that represents the world and its
structure. Of course, he could also do this by pen and paper or using
any other graph editor.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./gary_sketch.svg" >
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
He then opens this domain file in the Sublime Text 2 editor
</p>
<div class="org-src-container">

<pre class="src src-bash">$ sublime gary-hacker-world.pddl
</pre>
</div>
<p>
and starts to model his world. To this end, he uses the code snippets
<code>domain</code> for creating the domain skeleton, navigates inside the domain
file with \Tab, creates new type definitions with the snippets <code>t2</code>
and <code>t3</code>, predicates with <code>p1</code> and <code>p2</code> and the keyword <code>action</code> for
the action definition. After completing his first draft, he presses
\keystroke{f8], for saving his file and displaying the PDDL type
diagram and sees the following diagram:
</p>


<div class="figure">
<p><img src="file:///home/pold/Documents/BA/org-ba/hacker-world/diagrams/png-diagram3.png" alt="png-diagram3.png" />
</p>
</div>

<p>
He recognizes, that he forgot to model that system software
can be sub-divided into drivers and operating systems. Therefore he
closes the diagram and adds the missing type declaration and presses
F8 again. As everything is now as expected, he is very satisfied with
the result.
</p>



<p>
In his command line, he opens the PDDL problem file p01.pddl, adds the
problem skeleton by typing <code>problem</code> and \Tab.
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4"><span class="section-number-4">4.3.4</span> Evaluation</h4>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Type Diagram Generator</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Graphical notations, have some advantages compared to textual
notations, as they simplify the communication between developers and
help to quickly grasp the connection of related system units. 
</p>

<p>
But for all that one disadvantage has to be accepted: 
</p>

<p>
The UML was invented in order to standardize modeling in software
engineering (SE). The UML consists of several part notations, the here
presented tool uses the 'class diagram' notation, as PDDL types and
classes in OOP have strong resemblance (see Tiago 2006, p 535). 
</p>

<p>
Types play a major role in the PDDL design process: they are involved,
besides their definition, in the constants, predicates and actions
part. So, a fine grasp of their hierarchy, as well as their involved
predicates becomes handy and assists the KE in the planning process.
Types strongly resemble classes in object oriented programming
As mentioned in chapter (&#x2026;), the type definitions follow a specific
syntax. For example <code>truck car - vehicle</code> would indicate, that both
<code>truck</code> and <code>car</code> are subtypes of the super-type vehicle. 
</p>

<p>
Subtypes and corresponding super-types can be extracted using regular
expressions (regex). The regex
<code>#"((?:(?:\b[a-zA-Z](?:\w|-|_)+)\s+)+)-\s+(\b[a-zA-Z](?:\w|-|_)+)</code>
matches every kind of that form and a Clojure-friendly representation
in form of a hash-map can be created.
</p>

<p>
PDDL side &#x2013;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014; Clojure side
</p>

<p>
'(:types &#x2026; &#x2026; &#x2014; &#x2026;)                      {&#x2026; [&#x2026; &#x2026; &#x2026;], &#x2026;}
</p>


<div class="figure">
<p><img src="file:///home/pold/Documents/BA/org-ba/diagram.png" alt="diagram.png" />
</p>
<p><span class="figure-number">Figure 1:</span> Part of a PDDL domain and the corresponding, generated UML diagram</p>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Analysis</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Participants</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Ten non-paid students (six female) took part in the experiment. All
had knowledge about LISP syntax, but neither one had faced PDDL prior
to this study. 
</p>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Material</h3>
<div class="outline-text-3" id="text-5-2">
<p>
The usability of the Syntax Highlighter (see <a href="#sec:syntax">4.3</a>) and the Type
Diagram Generator (see <i>Type Diagram Generator</i>) were
tested.
</p>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Design</h3>
<div class="outline-text-3" id="text-5-3">
<p>
The participants had to 
</p>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Procedure</h3>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Conclusion and Outlook</h2>
<div class="outline-text-2" id="text-6">
<p>
The tools presented in this thesis have been designed to support
knowledge engineers in planning tasks. They can support engineers in
the early planning design process, as well as in the maintenance of
existing domains and problems. The communication between engineers can
be facilitated and 
</p>

<p>
The plug-in for the editor ST could be further extended to provide
features of common integrated developing environments (IDE). A build
script for providing input to a planner for auto-matching domain and
matching problem(s) (or problem and matching domain) in ST could be
convenient. 
Detecting of semantic errors besides syntactic errors (as in PDDL
Studio) could be the next step to detecting errors fast and accurate.
Possible semantic errors could be undeclared variables or predicates
in a domain specification.
</p>
</div>

<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Outlook</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Besides ICKEPS, as mentioned in the introduction, also the yearly
workshop Knowledge Engineering for Planning and Scheduling (KEPS) will
promote the research in planning and scheduling technology.
Potentially, the main effort of for implementing models in planning
will be shifted from the manual KE to the automated knowledge
acquisition (KA). Perception systems, Nevertheless, a engineer who
double-checks the generated tasks will be irreplaceable.
</p>



<p>
\printbibliography
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Appendix</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">ns</span> org-ba.core
  <span style="color: #7f7f7f;">(</span><span style="color: #90a959;">:gen-class</span> <span style="color: #90a959;">:main</span> true<span style="color: #7f7f7f;">)</span>
  <span style="color: #7f7f7f;">(</span><span style="color: #90a959;">:require</span> [clojure.tools.reader.edn <span style="color: #90a959;">:as</span> edn]
            [clojure.java.io <span style="color: #90a959;">:as</span> io]
            [clojure.pprint <span style="color: #90a959;">:as</span> pprint]
            [dorothy.core <span style="color: #90a959;">:as</span> doro]
            [rhizome.viz <span style="color: #90a959;">:as</span> rhi]
            [clojure.math.numeric-tower <span style="color: #90a959;">:as</span> math]
            [quil.core <span style="color: #90a959;">:as</span> quil]
            [clojure.java.shell <span style="color: #90a959;">:as</span> shell]
            [me.raynes.conch <span style="color: #90a959;">:as</span> conch]
            [me.raynes.conch.low-level <span style="color: #90a959;">:as</span> conch-sh]
            [fipp.printer <span style="color: #90a959;">:as</span> p]
            [fipp.edn <span style="color: #90a959;">:refer</span> <span style="color: #7f7f7f;">(</span>pprint<span style="color: #7f7f7f;">)</span> <span style="color: #90a959;">:rename</span> {pprint fipp}]
            [me.raynes.fs <span style="color: #90a959;">:as</span> fs]<span style="color: #7f7f7f;">)</span>
  <span style="color: #7f7f7f;">(</span><span style="color: #90a959;">:import</span> [javax.swing <span style="color: #b0c4de;">JPanel</span> <span style="color: #b0c4de;">JButton</span> <span style="color: #b0c4de;">JFrame</span> <span style="color: #b0c4de;">JLabel</span>]
           [java.awt.image <span style="color: #b0c4de;">BufferedImage</span> <span style="color: #b0c4de;">BufferedImageOp</span>]
           [java.io <span style="color: #b0c4de;">File</span>]<span style="color: #7f7f7f;">))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">read-lispstyle-edn</span>
  <span style="color: #90a959;">"Read one s-expression from a file"</span>
  [filename]
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">with-open</span> [rdr <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">java.io.PushbackReader.</span> <span style="color: #7f7f7f;">(</span>clojure.java.io/reader filename<span style="color: #7f7f7f;">))</span>]
    <span style="color: #7f7f7f;">(</span>edn/read rdr<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defmacro</span> <span style="color: #6a9fb5;">write-&gt;file</span>
  <span style="color: #90a959;">"Writes body to the given file name"</span>
  [filename &amp; body]
  `<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">do</span>
     <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">with-open</span> [w# <span style="color: #7f7f7f;">(</span>io/writer ~filename<span style="color: #7f7f7f;">)</span>]
     <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">binding</span> [*out* w#]
       ~@body<span style="color: #7f7f7f;">))</span>
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">println</span> <span style="color: #90a959;">"Written to file: "</span> ~filename<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">read-objs</span>
  <span style="color: #90a959;">"Read PDDL objects from a file and add type</span>
<span style="color: #90a959;">  (e.g. 'table bed' -&gt; (list table - furniture</span>
<span style="color: #90a959;">                        bed - furniture))"</span>
  [file object-type]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">as-&gt;</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">slurp</span> file<span style="color: #7f7f7f;">)</span> objs
        <span style="color: #7f7f7f;">(</span>clojure.string/split objs #<span style="color: #90a959;">"\s"</span><span style="color: #7f7f7f;">)</span>
        <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> #<span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> % <span style="color: #90a959;">" - "</span> object-type<span style="color: #7f7f7f;">)</span> objs<span style="color: #7f7f7f;">)))</span>



<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">create-pddl</span>
  <span style="color: #90a959;">"Creates a PDDL file from a list of objects and locations"</span>
  [objs-file objs-type]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span>
   <span style="color: #90a959;">"(define (domain domainName)</span>

<span style="color: #90a959;">  (:requirements</span>
<span style="color: #90a959;">     :durative-actions</span>
<span style="color: #90a959;">     :equality</span>
<span style="color: #90a959;">     :negative-preconditions</span>
<span style="color: #90a959;">     :numeric-fluents</span>
<span style="color: #90a959;">     :object-fluents</span>
<span style="color: #90a959;">     :typing)</span>

<span style="color: #90a959;">  (:types\n"</span>
   <span style="color: #7f7f7f;">(</span>pprint/cl-format nil <span style="color: #90a959;">"~{~&amp;~5@T~a~}"</span> <span style="color: #7f7f7f;">(</span>read-objs objs-file objs-type<span style="color: #7f7f7f;">))</span>
   <span style="color: #90a959;">")</span>

<span style="color: #90a959;">  (:constants</span>

<span style="color: #90a959;">  )</span>

<span style="color: #90a959;">  (:predicates</span>

<span style="color: #90a959;">  )</span>

<span style="color: #90a959;">  (:functions</span>

<span style="color: #90a959;">  )</span>

<span style="color: #90a959;">  (:durative-action actionName</span>
<span style="color: #90a959;">     :parameters (?x - &lt;objectType&gt;)</span>
<span style="color: #90a959;">     :duration (= ?duration #duration)</span>
<span style="color: #90a959;">     :condition (at start &lt;effects&gt;)</span>
<span style="color: #90a959;">     :effect (at end &lt;effects&gt;))</span>
<span style="color: #90a959;">)"</span>
   <span style="color: #7f7f7f;">))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">split-up</span>
  <span style="color: #90a959;">"Split a PDDL type list (:types obj1.1 obj1.2 - objT1 obj2 - objT2 ...)</span>
<span style="color: #90a959;">  into strings of subtypes and associated types,</span>
<span style="color: #90a959;">  [[subytype1 subtype 2 ... - type][subtype1 subtype2 ...][type]"</span>
  [coll]
  <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Remove ':types' if it is present.</span>
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [coll <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">if</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> <span style="color: #90a959;">:types</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> coll<span style="color: #7f7f7f;">))</span>
               <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">rest</span> coll<span style="color: #7f7f7f;">)</span>
               coll<span style="color: #7f7f7f;">)</span>]
    <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Capturing group 1 is type1.1 type1.2.</span>
    <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Capturing group 1 is type1.</span>
    <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">re-seq</span> #<span style="color: #90a959;">"</span><span style="color: #90a959; font-weight: bold;">(</span><span style="color: #90a959; font-weight: bold;">(?:</span><span style="color: #90a959; font-weight: bold;">(?:</span><span style="color: #90a959;">\b[a-zA-Z]</span><span style="color: #90a959; font-weight: bold;">(?:</span><span style="color: #90a959;">\w</span><span style="color: #90a959; font-weight: bold;">|</span><span style="color: #90a959;">-</span><span style="color: #90a959; font-weight: bold;">|</span><span style="color: #90a959;">_</span><span style="color: #90a959; font-weight: bold;">)</span><span style="color: #90a959;">+</span><span style="color: #90a959; font-weight: bold;">)</span><span style="color: #90a959;">\s+</span><span style="color: #90a959; font-weight: bold;">)</span><span style="color: #90a959;">+</span><span style="color: #90a959; font-weight: bold;">)</span><span style="color: #90a959;">-\s+</span><span style="color: #90a959; font-weight: bold;">(</span><span style="color: #90a959;">\b[a-zA-Z]</span><span style="color: #90a959; font-weight: bold;">(?:</span><span style="color: #90a959;">\w</span><span style="color: #90a959; font-weight: bold;">|</span><span style="color: #90a959;">-</span><span style="color: #90a959; font-weight: bold;">|</span><span style="color: #90a959;">_</span><span style="color: #90a959; font-weight: bold;">)</span><span style="color: #90a959;">+</span><span style="color: #90a959; font-weight: bold;">)</span><span style="color: #90a959;">"</span>
            <span style="color: #7f7f7f;">(</span>clojure.string/<span style="color: #b0c4de;">join</span> <span style="color: #90a959;">" "</span> coll<span style="color: #7f7f7f;">))))</span>


<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">types-&gt;hash-map-helper</span>
  <span style="color: #90a959;">"Convert splitted type list (['&lt;expr&gt;' '&lt;subtype1.1&gt; &lt;subtype1.2&gt; ...' '&lt;type1&gt;']</span>
<span style="color: #90a959;">  to a hash-map {'&lt;type1&gt;': ['&lt;subtype1.1&gt;' '&lt;subtype1.2&gt;' ...], '&lt;type2&gt;': ...}"</span>
  [coll]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">reduce</span> <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">fn</span> [h-map [_ objs obj-type]]
            <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [key-obj-type <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">keyword</span> obj-type<span style="color: #7f7f7f;">)</span>
                  existing-vals <span style="color: #7f7f7f;">(</span>key-obj-type h-map<span style="color: #7f7f7f;">)</span>]
              <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">assoc</span> h-map
                key-obj-type
                <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">concat</span> existing-vals
                        <span style="color: #7f7f7f;">(</span>clojure.string/split objs #<span style="color: #90a959;">"\s"</span><span style="color: #7f7f7f;">)))))</span>
          {}
          coll<span style="color: #7f7f7f;">))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">types-&gt;hash-map</span>
  <span style="color: #90a959;">"Splits types and converts them into a hash-map"</span>
  [pddl-types]
  <span style="color: #7f7f7f;">(</span>types-&gt;hash-map-helper <span style="color: #7f7f7f;">(</span>split-up pddl-types<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">map-entry-&gt;TikZ-seq</span>
  <span style="color: #90a959;">"Converts a hashmap entry (:key [val1 val2 ...])</span>
<span style="color: #90a959;">to a TikZ string (key -- { val1, val2 })"</span>
  [entry]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span>
   <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">name</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">key</span> entry<span style="color: #7f7f7f;">))</span>
   <span style="color: #90a959;">" -- "</span>
   <span style="color: #90a959;">"{"</span> <span style="color: #7f7f7f;">(</span>clojure.string/<span style="color: #b0c4de;">join</span> <span style="color: #90a959;">", "</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">val</span> entry<span style="color: #7f7f7f;">))</span> <span style="color: #90a959;">"}"</span><span style="color: #7f7f7f;">))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">hash-map-&gt;TikZ-out</span>
  <span style="color: #90a959;">"Converts complete PDDL type hash-map to TikZ file"</span>
  [h-map]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span>
   <span style="color: #90a959;">"\\documentclass[tikz]{standalone}</span>

<span style="color: #90a959;">\\usepackage[utf8]{inputenc}</span>

<span style="color: #90a959;">\\usepackage{tikz}</span>

<span style="color: #90a959;">\\usetikzlibrary{graphdrawing}</span>
<span style="color: #90a959;">\\usetikzlibrary{graphs}</span>
<span style="color: #90a959;">\\usegdlibrary{layered,trees}</span>

<span style="color: #90a959;">\\begin{document}</span>

<span style="color: #90a959;">\\begin{tikzpicture}</span>

<span style="color: #90a959;">\\graph[layered layout, nodes={draw,circle,fill=blue!20,font=\\bfseries}]</span>
<span style="color: #ac4142; font-weight: bold;">{</span>
<span style="color: #90a959;">  "</span> <span style="color: #7f7f7f;">(</span>clojure.string/<span style="color: #b0c4de;">join</span> <span style="color: #90a959;">",\n  "</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> map-entry-&gt;TikZ-seq h-map<span style="color: #7f7f7f;">))</span>
  <span style="color: #90a959;">"</span>
<span style="color: #90a959;">};</span>

<span style="color: #90a959;">\\end{tikzpicture}</span>
<span style="color: #90a959;">\\end{document}"</span><span style="color: #7f7f7f;">))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">types-map-entry-&gt;dot-language</span>
  <span style="color: #90a959;">"Converts one hash-map entry</span>
<span style="color: #90a959;">to the dot language"</span>
  [entry]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span>
   <span style="color: #90a959;">"\""</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">name</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">key</span> entry<span style="color: #7f7f7f;">))</span> <span style="color: #90a959;">"\""</span>
   <span style="color: #90a959;">" -&gt; "</span>
   <span style="color: #90a959;">"{"</span> <span style="color: #7f7f7f;">(</span>clojure.string/<span style="color: #b0c4de;">join</span> <span style="color: #90a959;">" "</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> #<span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> <span style="color: #90a959;">"\""</span> % <span style="color: #90a959;">"\""</span><span style="color: #7f7f7f;">)</span>  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">val</span> entry<span style="color: #7f7f7f;">)))</span> <span style="color: #90a959;">"}"</span><span style="color: #7f7f7f;">))</span>


<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">types-hash-map-&gt;dot-language</span>
  <span style="color: #90a959;">"Converts a PDDL types hash-map</span>
<span style="color: #90a959;">to the dot language notation"</span>
  [pddl-types-map]
  <span style="color: #7f7f7f;">(</span>clojure.string/<span style="color: #b0c4de;">join</span> <span style="color: #90a959;">"\n"</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> types-map-entry-&gt;dot-language pddl-types-map<span style="color: #7f7f7f;">)))</span>

<span style="color: #b0b0b0;">;;; </span><span style="color: #b0b0b0;">Read PDDL predicates and generate UML 'type' diagram</span>
<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">get-types-in-predicate</span>
  <span style="color: #90a959;">"Takes a PDDL predicate,</span>
<span style="color: #90a959;">  e.g. '(at ?x - location ?y - object)</span>
<span style="color: #90a959;">  and returns the involved types, e.g.</span>
<span style="color: #90a959;">  '(location object)"</span>
  [pddl-pred]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">remove</span>
   <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">fn</span> [s]
     <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [first-char <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">name</span> s<span style="color: #7f7f7f;">))</span>]
       <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">or</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> \- first-char<span style="color: #7f7f7f;">)</span>
           <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> \? first-char<span style="color: #7f7f7f;">))))</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">rest</span> pddl-pred<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">pddl-pred-&gt;hash-map-long</span>
  <span style="color: #90a959;">"Takes a PDDL predicate, e.g.</span>
<span style="color: #90a959;">  '(at ?x - location ?y - object) and returns a</span>
<span style="color: #90a959;">  hash-map, that assigns the involved types</span>
<span style="color: #90a959;">  to this predicate, e.g.</span>
<span style="color: #90a959;">  {location [(at ?x - location ?y - object)],</span>
<span style="color: #90a959;">   object [(at ?x - location ?y - object)]}"</span>
  [pddl-pred]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">reduce</span> <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">fn</span> [h-map pddl-type]
            <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">assoc</span> h-map
              pddl-type
              <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">list</span> pddl-pred<span style="color: #7f7f7f;">)))</span>
          {}
          <span style="color: #7f7f7f;">(</span>get-types-in-predicate pddl-pred<span style="color: #7f7f7f;">)))</span>


<span style="color: #7f7f7f;">(</span>pddl-pred-&gt;hash-map-long '<span style="color: #7f7f7f;">(</span>at ?x - location ?y - object<span style="color: #7f7f7f;">))</span>

<span style="color: #b0b0b0;">;;; </span><span style="color: #ac4142; font-weight: bold;">TODO</span><span style="color: #b0b0b0;">: Create short version wiht prolog predicate style</span>
<span style="color: #b0b0b0;">;;; </span><span style="color: #b0b0b0;">e.g. at/2</span>
<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">all-pddl-preds-&gt;hash-map-long</span>
  <span style="color: #90a959;">"Takes a list of PDDL predicates and</span>
<span style="color: #90a959;">  returns a hash-map of types and the</span>
<span style="color: #90a959;">  assigned predicate"</span>
  [pddl-preds]
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [pddl-preds <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">if</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> <span style="color: #90a959;">:predicates</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> pddl-preds<span style="color: #7f7f7f;">))</span>
                     <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">rest</span> pddl-preds<span style="color: #7f7f7f;">)</span>
                     pddl-preds<span style="color: #7f7f7f;">)</span>]
    <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">apply</span> merge-with concat
           <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> pddl-pred-&gt;hash-map-long pddl-preds<span style="color: #7f7f7f;">))))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">hash-map-&gt;dot</span>
  <span style="color: #90a959;">"Converts a hash-map to</span>
<span style="color: #90a959;">  dot language for creating</span>
<span style="color: #90a959;">  UML diagrams"</span>
  [h-map]  
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">fn</span> [map-entry]
         <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">key</span> map-entry<span style="color: #7f7f7f;">)</span>
              <span style="color: #90a959;">"[label = \"{"</span>
              <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">key</span> map-entry<span style="color: #7f7f7f;">)</span>
              <span style="color: #90a959;">"|"</span>
              <span style="color: #7f7f7f;">(</span>clojure.string/<span style="color: #b0c4de;">join</span> <span style="color: #90a959;">"\\l"</span>  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">val</span> map-entry<span style="color: #7f7f7f;">))</span>
              <span style="color: #90a959;">"}\"]\n"</span><span style="color: #7f7f7f;">))</span>
       h-map<span style="color: #7f7f7f;">))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">hash-map-&gt;dot-with-style</span>
  <span style="color: #90a959;">"Adds dot template to</span>
<span style="color: #90a959;">hash-map&gt;dot"</span>
  [h-map]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span>
   <span style="color: #90a959;">"digraph hierarchy {</span>
<span style="color: #90a959;">node[shape=record,style=filled,fillcolor=gray92]</span>
<span style="color: #90a959;">edge[dir=back, arrowtail=empty]</span>
<span style="color: #90a959;">\n"</span>
   <span style="color: #7f7f7f;">(</span>clojure.string/<span style="color: #b0c4de;">join</span> <span style="color: #7f7f7f;">(</span>hash-map-&gt;dot h-map<span style="color: #7f7f7f;">))</span>
   <span style="color: #90a959;">"}"</span><span style="color: #7f7f7f;">))</span>


<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">PDDL-&gt;dot-with-style</span>
  <span style="color: #90a959;">"Adds dot template to</span>
<span style="color: #90a959;">hash-map&gt;dot"</span>
  [preds types]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span>
   <span style="color: #90a959;">"digraph hierarchy {</span>
<span style="color: #90a959;">node[shape=record,style=filled,fillcolor=gray92]</span>
<span style="color: #90a959;">edge[dir=back, arrowtail=empty]</span>
<span style="color: #90a959;">\n"</span>

   <span style="color: #7f7f7f;">(</span>clojure.string/<span style="color: #b0c4de;">join</span> <span style="color: #7f7f7f;">(</span>hash-map-&gt;dot <span style="color: #7f7f7f;">(</span>all-pddl-preds-&gt;hash-map-long preds<span style="color: #7f7f7f;">)))</span>
   <span style="color: #7f7f7f;">(</span>types-hash-map-&gt;dot-language <span style="color: #7f7f7f;">(</span>types-&gt;hash-map types<span style="color: #7f7f7f;">))</span>

   <span style="color: #90a959;">"}"</span><span style="color: #7f7f7f;">))</span>

<span style="color: #b0b0b0;">;;; </span><span style="color: #b0b0b0;">Example for Predicate:</span>
<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">def</span> <span style="color: #6a9fb5;">predicates</span> 
  '<span style="color: #7f7f7f;">(</span><span style="color: #90a959;">:predicates</span> <span style="color: #7f7f7f;">(</span>at ?x - location ?y - object<span style="color: #7f7f7f;">)</span>
                <span style="color: #7f7f7f;">(</span>have ?x - object<span style="color: #7f7f7f;">)</span> 
                <span style="color: #7f7f7f;">(</span>hot ?x - object<span style="color: #7f7f7f;">)</span>
                <span style="color: #7f7f7f;">(</span>on ?f - furniture ?o - object<span style="color: #7f7f7f;">)))</span>

<span style="color: #b0b0b0;">;;; </span><span style="color: #b0b0b0;">Example invocation:</span>
<span style="color: #7f7f7f;">(</span>hash-map-&gt;dot-with-style <span style="color: #7f7f7f;">(</span>all-pddl-preds-&gt;hash-map-long predicates<span style="color: #7f7f7f;">))</span>


<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">get-PDDL-construct</span>
  <span style="color: #90a959;">"Takes a PDDL keyword and a PDDL domain/problem</span>
<span style="color: #90a959;">file and returns all parts of the file that</span>
<span style="color: #90a959;">belong to the PDDL keyword."</span>
  [pddl-keyword pddl-file]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">filter</span> #<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">and</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">seq?</span> %<span style="color: #7f7f7f;">)</span>
                <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">keyword</span> pddl-keyword<span style="color: #7f7f7f;">)</span>
                   <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> %<span style="color: #7f7f7f;">)))</span>
          <span style="color: #7f7f7f;">(</span>read-lispstyle-edn pddl-file<span style="color: #7f7f7f;">)))</span>


                                        <span style="color: #b0b0b0;">; </span><span style="color: #ac4142; font-weight: bold;">TODO</span><span style="color: #b0b0b0;">: Throw error if length != 1</span>
<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">get-PDDL-predicates</span>
  <span style="color: #90a959;">"Get all predicates in a PDDL file"</span>
  [pddl-file]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> <span style="color: #7f7f7f;">(</span>get-PDDL-construct 'predicates pddl-file<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">get-PDDL-init</span>
  <span style="color: #90a959;">"Get all predicates in a PDDL file"</span>
  [pddl-file]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> <span style="color: #7f7f7f;">(</span>get-PDDL-construct 'init pddl-file<span style="color: #7f7f7f;">)))</span>


                                        <span style="color: #b0b0b0;">; </span><span style="color: #ac4142; font-weight: bold;">TODO</span><span style="color: #b0b0b0;">: Throw error if length != 1</span>
<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">get-PDDL-types</span>
  <span style="color: #90a959;">"Get all types in a PDDL file"</span>
  [pddl-file]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> <span style="color: #7f7f7f;">(</span>get-PDDL-construct 'types pddl-file<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">PDDL-&gt;dot</span>
  <span style="color: #90a959;">"Takes a complete PDDL file</span>
<span style="color: #90a959;">and generates a UML type diagram"</span>
  [pddl-file]
  <span style="color: #7f7f7f;">(</span>PDDL-&gt;dot-with-style <span style="color: #7f7f7f;">(</span>get-PDDL-predicates pddl-file<span style="color: #7f7f7f;">)</span>
                        <span style="color: #7f7f7f;">(</span>get-PDDL-types pddl-file<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">PDDL-&gt;dot-commandline-input</span>
  <span style="color: #90a959;">"Assumes that the PDDL input is</span>
<span style="color: #90a959;">a string and 'reads' this string"</span>
  [pddl-file]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">print</span> <span style="color: #90a959;">"The type is "</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">type</span> pddl-file<span style="color: #7f7f7f;">))</span>
  <span style="color: #7f7f7f;">(</span>PDDL-&gt;dot <span style="color: #7f7f7f;">(</span>edn/read-string pddl-file<span style="color: #7f7f7f;">)))</span>


<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">PDDL-&gt;dot-file-input</span>
  <span style="color: #90a959;">"Reads PDDL file"</span>
  [pddl-file-name]
  <span style="color: #7f7f7f;">(</span>PDDL-&gt;dot pddl-file-name<span style="color: #7f7f7f;">))</span>

<span style="color: #b0b0b0;">;;;; </span><span style="color: #b0b0b0;">math helper functions</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">sqr</span>
  <span style="color: #90a959;">"Square of a number"</span>
  [x]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">*</span> x x<span style="color: #7f7f7f;">))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">round-places</span> [number decimals]
  <span style="color: #90a959;">"Round to decimal places"</span>
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [factor <span style="color: #7f7f7f;">(</span>math/expt 10 decimals<span style="color: #7f7f7f;">)</span>]
    <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">double</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">/</span> <span style="color: #7f7f7f;">(</span>math/round <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">*</span> factor number<span style="color: #7f7f7f;">))</span> factor<span style="color: #7f7f7f;">))))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">euclidean-squared-distance</span>
  <span style="color: #90a959;">"Computes the Euclidean squared distance between two sequences"</span>
  [a b]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">reduce</span> + <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">comp</span> sqr -<span style="color: #7f7f7f;">)</span> a b<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">euclidean-distance</span>
  <span style="color: #90a959;">"Computes the Euclidean distance between two sequences"</span>
  [a b]
  <span style="color: #7f7f7f;">(</span>math/sqrt <span style="color: #7f7f7f;">(</span>euclidean-squared-distance a b<span style="color: #7f7f7f;">)))</span>

<span style="color: #b0b0b0;">;;;; </span><span style="color: #b0b0b0;">End math helper functions</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">calc-distance-good</span>
  <span style="color: #90a959;">"Calculates the distance and writes</span>
<span style="color: #90a959;">the calculated distances to a string</span>
<span style="color: #90a959;">IS VERY GOOD !!!"</span>
  [locations]
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">for</span> [[ _ loc1 &amp; xyz-1] locations
        [ _ loc2 &amp; xyz-2] locations]
    <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Euclidean distance rounded to 4 decimal places.</span>
    <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">list</span> 'distance loc1 loc2 <span style="color: #7f7f7f;">(</span>round-places <span style="color: #7f7f7f;">(</span>euclidean-distance xyz-1 xyz-2<span style="color: #7f7f7f;">)</span> 4<span style="color: #7f7f7f;">))))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">get-specified-predicates-in-pddl-file</span>
  <span style="color: #90a959;">"Extracts all locations in the predicates part</span>
<span style="color: #ac4142; font-weight: bold;">(</span><span style="color: #90a959;">by the specified name) in a PDDL file"</span>
  [pddl-file predicate-name]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">filter</span> #<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">and</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">seq?</span> %<span style="color: #7f7f7f;">)</span>
                <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> predicate-name <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> %<span style="color: #7f7f7f;">)))</span>
          <span style="color: #7f7f7f;">(</span>get-PDDL-predicates pddl-file<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">get-specified-inits-in-pddl-file</span>
  <span style="color: #90a959;">"Extracts all locations in the init part</span>
<span style="color: #ac4142; font-weight: bold;">(</span><span style="color: #90a959;">by the specified name) in a PDDL problem"</span>
  [pddl-file predicate-name]
  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">filter</span> #<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">and</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">seq?</span> %<span style="color: #7f7f7f;">)</span>
                <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> predicate-name <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> %<span style="color: #7f7f7f;">)))</span>
          <span style="color: #7f7f7f;">(</span>get-PDDL-init pddl-file<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">calc-distance</span>
  <span style="color: #90a959;">"Calculate distances of PDDL objects"</span>
  [locations]
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">for</span> [[ _ loc1 &amp; xyz-1] locations
        [ _ loc2 &amp; xyz-2] locations]
    <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Euclidean distance rounded to 4 decimal places.</span>
    `<span style="color: #7f7f7f;">(</span>~'distance ~loc1 ~loc2
                 ~<span style="color: #7f7f7f;">(</span>euclidean-distance xyz-1 xyz-2<span style="color: #7f7f7f;">))))</span>

<span style="color: #b0b0b0;">; </span><span style="color: #b0b0b0;">LOOK UP: extended equality: 'hello = :hello</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">add-part-to-PDDL</span>
  <span style="color: #90a959;">"Takes a PDDL domain or problem</span>
<span style="color: #90a959;">and add the specified part to the</span>
<span style="color: #90a959;">specified position"</span>
  [pddl-file position part]

  <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> #<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">if</span> <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">and</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">seq?</span> %<span style="color: #7f7f7f;">)</span>
                 <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">keyword</span> position<span style="color: #7f7f7f;">)</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> %<span style="color: #7f7f7f;">)))</span>
          <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">concat</span> % part<span style="color: #7f7f7f;">)</span>
          %<span style="color: #7f7f7f;">)</span>
       <span style="color: #7f7f7f;">(</span>read-lispstyle-edn pddl-file<span style="color: #7f7f7f;">)))</span>

<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">find-new-file-name</span>
  <span style="color: #90a959;">"Take a filename and determines, the new number</span>
<span style="color: #90a959;">that has to be added to create a new file. E.g.</span>
<span style="color: #90a959;">file1.img file2.img file3.img means that, file4.img</span>
<span style="color: #90a959;">has to be created"</span>
  [filename extension]
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">loop</span> [n 0]
    <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">if-not</span> <span style="color: #7f7f7f;">(</span>io/.exists <span style="color: #7f7f7f;">(</span>io/as-file
                         <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> filename n extension<span style="color: #7f7f7f;">)))</span>
      <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> filename n extension<span style="color: #7f7f7f;">)</span>
      <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">recur</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">inc</span> n<span style="color: #7f7f7f;">)))))</span>


<span style="color: #b0b0b0;">;;; </span><span style="color: #b0b0b0;">Copied from https://www.refheap.com/9034</span>
<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">exit-on-close</span> [sketch]
  <span style="color: #90a959;">"Guarantees that Clojure script will be</span>
<span style="color: #90a959;">exited after the JFrame is closed"</span>
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [frame <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">-&gt;</span> sketch <span style="color: #b0c4de;">.getParent</span> <span style="color: #b0c4de;">.getParent</span> <span style="color: #b0c4de;">.getParent</span> <span style="color: #b0c4de;">.getParent</span><span style="color: #7f7f7f;">)</span>]
    <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">.setDefaultCloseOperation</span> frame javax.swing.JFrame/EXIT_ON_CLOSE<span style="color: #7f7f7f;">)))</span>


<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">extract-locations-from-file</span>
  <span style="color: #90a959;">"Read a Blender LISP file and write object positions to out-file"</span>
  [file-in file-out]
  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [map-destructorer-local <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">fn</span> [[_addgv _furniture object
                                      [_make-instance _object-detail
                                          _pose [_tfmps
                                                _type-name
                                                _type-num
                                                [_vector-3d x y z &amp; more]
                                                &amp; _more1]
                                       &amp; _more2]]] <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">list</span> <span style="color: #90a959;">"location"</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">name</span> object<span style="color: #7f7f7f;">)</span> x y z<span style="color: #7f7f7f;">))</span>]
    <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">with-open</span> [rdr <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">java.io.PushbackReader.</span> <span style="color: #7f7f7f;">(</span>io/reader file-in<span style="color: #7f7f7f;">))</span>]
      <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">println</span>
      <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">doall</span>
          <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">map</span> map-destructorer-local
               <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">filter</span> #<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">and</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">seq?</span> %<span style="color: #7f7f7f;">)</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> 'addgv <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> %<span style="color: #7f7f7f;">)))</span>
                       <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">take-while</span> #<span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">not=</span> % <span style="color: #90a959;">:end</span><span style="color: #7f7f7f;">)</span>
                                   <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">repeatedly</span>  #<span style="color: #7f7f7f;">(</span>edn/read {<span style="color: #90a959;">:eof</span> <span style="color: #90a959;">:end</span>} rdr<span style="color: #7f7f7f;">))))))))))</span>


<span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Main method</span>
<span style="color: #b0b0b0;">;; </span><span style="color: #ac4142; font-weight: bold;">TODO</span><span style="color: #b0b0b0;">: Command line options</span>
<span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">-main</span>
  <span style="color: #90a959;">"Runs the input/output scripts"</span>
  [&amp; args]

  <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">cond</span>
   <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Create a new PDDL project</span>
   <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> <span style="color: #90a959;">"new"</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> args<span style="color: #7f7f7f;">))</span>
   <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [project-name <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">second</span> args<span style="color: #7f7f7f;">)</span>]
     <span style="color: #7f7f7f;">(</span>fs/mkdir project-name<span style="color: #7f7f7f;">)</span>
     <span style="color: #7f7f7f;">(</span>fs/mkdir <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> project-name <span style="color: #90a959;">"/dot"</span><span style="color: #7f7f7f;">))</span>
     <span style="color: #7f7f7f;">(</span>fs/mkdir <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> project-name <span style="color: #90a959;">"/diagrams"</span><span style="color: #7f7f7f;">))</span>
     <span style="color: #7f7f7f;">(</span>fs/mkdir <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> project-name <span style="color: #90a959;">"/domains"</span><span style="color: #7f7f7f;">))</span>
     <span style="color: #7f7f7f;">(</span>fs/mkdir <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> project-name <span style="color: #90a959;">"/problems"</span><span style="color: #7f7f7f;">))</span>
     <span style="color: #7f7f7f;">(</span>fs/create <span style="color: #7f7f7f;">(</span>io/file <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> project-name <span style="color: #90a959;">"/domain.pddl"</span><span style="color: #7f7f7f;">)))</span>
     <span style="color: #7f7f7f;">(</span>fs/create <span style="color: #7f7f7f;">(</span>io/file <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> project-name <span style="color: #90a959;">"/p01.pddl"</span><span style="color: #7f7f7f;">))))</span>

   <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">-l flag for adding locations in PDDL file</span>
   <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">=</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">second</span> args<span style="color: #7f7f7f;">)</span> <span style="color: #90a959;">"-l"</span><span style="color: #7f7f7f;">)</span>
   <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [content <span style="color: #7f7f7f;">(</span>add-part-to-PDDL <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> args<span style="color: #7f7f7f;">)</span>
                                   'init
                                   <span style="color: #7f7f7f;">(</span>calc-distance-good
                                    <span style="color: #7f7f7f;">(</span>get-specified-inits-in-pddl-file <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> args<span style="color: #7f7f7f;">)</span>
                                                                      'location<span style="color: #7f7f7f;">)))</span>
         new-filename <span style="color: #7f7f7f;">(</span>clojure.string/replace-first <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> args<span style="color: #7f7f7f;">)</span>
                                                    #<span style="color: #90a959;">"</span><span style="color: #90a959; font-weight: bold;">(</span><span style="color: #90a959;">.+</span><span style="color: #90a959; font-weight: bold;">)</span><span style="color: #90a959;">.pddl"</span>
                                                    <span style="color: #90a959;">"$1-locations.pddl"</span><span style="color: #7f7f7f;">)</span>] <span style="color: #b0b0b0;">; </span><span style="color: #ac4142; font-weight: bold;">TODO</span><span style="color: #b0b0b0;">: location as arg</span>

     <span style="color: #7f7f7f;">(</span>write-&gt;file new-filename <span style="color: #7f7f7f;">(</span>pprint/pprint content<span style="color: #7f7f7f;">)))</span>


   <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Write dot graph to file.</span>
   <span style="color: #90a959;">:else</span>
   <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [input-domain <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">first</span> args<span style="color: #7f7f7f;">)</span>
         new-dot-filename <span style="color: #7f7f7f;">(</span>find-new-file-name <span style="color: #90a959;">"dot/dot-diagram"</span> <span style="color: #90a959;">".dot"</span><span style="color: #7f7f7f;">)</span>
         new-png-filename <span style="color: #7f7f7f;">(</span>find-new-file-name <span style="color: #90a959;">"diagrams/png-diagram"</span> <span style="color: #90a959;">".png"</span><span style="color: #7f7f7f;">)</span>
         input-domain-filename <span style="color: #7f7f7f;">(</span>fs/name input-domain<span style="color: #7f7f7f;">)</span>
         domain-version <span style="color: #7f7f7f;">(</span>find-new-file-name
                         <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> <span style="color: #90a959;">"domains/"</span> input-domain-filename<span style="color: #7f7f7f;">)</span> <span style="color: #7f7f7f;">(</span>fs/extension input-domain<span style="color: #7f7f7f;">))</span>]

     <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Save input domain version in folder domains.</span>
     <span style="color: #7f7f7f;">(</span>fs/copy+ input-domain domain-version<span style="color: #7f7f7f;">)</span>     

     <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Create folders for dot files and png diagrams</span>
     <span style="color: #7f7f7f;">(</span>fs/mkdir <span style="color: #90a959;">"dot"</span><span style="color: #7f7f7f;">)</span>
     <span style="color: #7f7f7f;">(</span>fs/mkdir <span style="color: #90a959;">"diagrams"</span><span style="color: #7f7f7f;">)</span>

     <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Create dot language file in dot folder.</span>
     <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">doall</span>
      <span style="color: #7f7f7f;">(</span>write-&gt;file new-dot-filename
                   <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">print</span> <span style="color: #7f7f7f;">(</span>PDDL-&gt;dot-file-input input-domain<span style="color: #7f7f7f;">))))</span>

     <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Create a png file from dot</span>
     <span style="color: #7f7f7f;">(</span>fs/exec <span style="color: #90a959;">"dot"</span> <span style="color: #90a959;">"-Tpng"</span> <span style="color: #90a959;">"-o"</span> new-png-filename new-dot-filename<span style="color: #7f7f7f;">)</span>

     <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Settings for displaying the generated diagram.</span>
     <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">def</span> <span style="color: #6a9fb5;">img</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">ref</span> nil<span style="color: #7f7f7f;">))</span>

     <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">setup</span> []
       <span style="color: #7f7f7f;">(</span>quil/background 0<span style="color: #7f7f7f;">)</span>
       <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">dosync</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">ref-set</span> img <span style="color: #7f7f7f;">(</span>quil/load-image new-png-filename<span style="color: #7f7f7f;">))))</span>

     <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">def</span> <span style="color: #6a9fb5;">img-size</span>
       <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">with-open</span> [r <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">java.io.FileInputStream.</span> new-png-filename<span style="color: #7f7f7f;">)</span>]
         <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">let</span> [image <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">javax.imageio.ImageIO/read</span> r<span style="color: #7f7f7f;">)</span>
               img-width <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">.getWidth</span> image<span style="color: #7f7f7f;">)</span>
               img-height <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">.getHeight</span> image<span style="color: #7f7f7f;">)</span>]
           [img-width img-height]<span style="color: #7f7f7f;">)))</span>

     <span style="color: #7f7f7f;">(</span><span style="color: #aa759f;">defn</span> <span style="color: #6a9fb5;">draw</span> []
       <span style="color: #7f7f7f;">(</span>quil/image @img 0 0<span style="color: #7f7f7f;">))</span>

     <span style="color: #b0b0b0;">;; </span><span style="color: #b0b0b0;">Display png file in JFrame.</span>
     <span style="color: #7f7f7f;">(</span>exit-on-close
      <span style="color: #7f7f7f;">(</span>quil/sketch
       <span style="color: #90a959;">:title</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">str</span> <span style="color: #90a959;">"PDDL Type Diagram - "</span> input-domain-filename<span style="color: #7f7f7f;">)</span>
       <span style="color: #90a959;">:setup</span> setup
       <span style="color: #90a959;">:draw</span> draw
       <span style="color: #90a959;">:size</span> <span style="color: #7f7f7f;">(</span><span style="color: #b0c4de;">vec</span> img-size<span style="color: #7f7f7f;">))))))</span>
</pre>
</div>
<div class="org-src-container">

<pre class="src src-YAML"># [PackageDev] target_format: plist, ext: tmLanguage
---
name: PDDL
scopeName: text.pddl
fileTypes: [pddl]
uuid: 2aef09fc-d29e-4efd-bf1a-974598feb7a9

patterns:

#####################
### Customization ###

- include: '#domain'
- include: '#problem'
- include: '#comment'

##################
### Repository ###

repository:


##############################
### General specifications ###
##############################

  built-in-var:
    match: \?duration 
    name: variable.language.pddl

  variable:
    match: '(?:^|\s+)(\?[a-zA-Z](?:\w|-|_)*)'
    # name: variable.other.pddl
    name: keyword.other.pddl # TODO: changeback again to variable.other.pddl
    # this is just a dirty hack for highlighting

  pddl-expr:
    match: '(?:^|\s+)([a-zA-Z](?:\w|-|_)*)(?!:|\?)\b'
    captures:
      '1': {name: string.unquoted.pddl}
    #name: string.unquoted.pddl

  comment:
    comment: "Comments beginning with ';'"
    name: comment.line.semicolon.pddl
    match: ;.*

  number:
    name: constant.numeric.pddl
    match: \b((0(x|X)[0-9a-fA-F]*)|(([0-9]+\.?[0-9]*)|(\.[0-9]+))((e|E)(\+|-)?[0-9]+)?)(L|l|UL|ul|u|U|F|f|ll|LL|ull|ULL)?\b

  keyword:
    name: storage.type.pddl # TODO: UPDATE
    match: :(constraints|metric|length)


######################
### Domain Helpers ###
######################


  function-keyword:
    name: support.function.pddl
    match: (assign|scale-up|scale-down|increase|decrease)


  # TODO
  other-keyword:
    name: support.other.pddl
    comment: "Remove parent or do sth that the paren isn't highlighted"
    match: \b(forall|(at\s+(start|end))|over)\b


  language-constant:
    name: constant.language.pddl
    match: (start|end|all)

  action-keyword:
    name: keyword.operator.pddl
    match: ':(?i:(parameters|vars|precondition|effect))(?!:|\?)\b'

  durative-action-keyword:
    name: keyword.operator.pddl
    match: ':(?i:(parameters|vars|duration|condition|effect))(?!:|\?)\b'



#############################
### Domain specifications ###
#############################

  domain:  
    patterns:
    - comment: "domain definition "
      name: meta.function.pddl
      begin: '\(\s*((?i:define))\b(?!\s+\(problem)'
      beginCaptures:
        '1': {name: storage.type.pddl}
      end: '\)'
      patterns: 
        - include: '#comment'
        - include: '#domain-name-in-define'
        - include: '#requirement'
        - include: '#types'
        - include: '#constants'
        - include: '#predicates'
        - include: '#new-functions'
        - include: '#action'
        - include: '#durative-action'
        - include: '#any-sexpr'


  domain-name-in-define:
    patterns:
      - comment: "Domain name in problem file"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(domain))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#comment'
          - name: invalid.illegal.pddl
            match: (\s+(?:\w|-)+){2,}
          - include: '#pddl-expr'

  requirement:
    patterns:
      - comment: "Requirement"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:requirements))\b'
        beginCaptures:
          '1': {name: storage.type.pddl}
        end: '\)'
        patterns:
        - name: keyword.other.pddl
          match:  :(?i:(strips|typing|negative-preconditions|disjunctive-preconditions|equality|existential-preconditions|universal-preconditions|quantified-preconditions|conditional-effects|fluents|numeric-fluents|object-fluents|adl|durative-actions|duration-inequalities|continuous-effects|derived-predicates|timed-initial-literals|preferences|constraints|action-costs))\b

  types:
    patterns:
      - comment: "Types"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:types))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - name: meta.keyword.pddl
            captures:
              '1': {name: constant.character.pddl}
              #'1': {name: string.unquoted.pddl}
              '2': {name: entity.name.function.pdd}
            match:  (-)(?:^|\s+)([a-zA-Z](?:\w|-|_)*)
          - include: '#either'
          - include: '#pddl-expr'
          - include: '#any-sexpr'

  constants:
    patterns:
      - comment: "Constants"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:constants))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - name: meta.keyword.pddl
            captures:
              '1': {name: entity.name.function.pddl}
              #'1': {name: string.unquoted.pddl}
              '2': {name: entity.name.tag.pddl}
            match:  (-)(?:^|\s+)([a-zA-Z](?:\w|-|_)*)
          - include: '#either'
          - include: '#pddl-expr'

  predicate:
    patterns:
      - begin: '\(\s*((?:\w|-)+)'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#variable'
          - name: meta.name.function.pddl
            captures:
              '1': {name: constant.character.pddl}
              '2': {name: entity.name.function.pddl}
            match: (-)(?:^|\s+)([a-zA-Z](?:\w|-|_)*)

  init-predicate:
    patterns:
      - begin: '\(\s*((?:\w|-)+)'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#pddl-expr'
          - include: '#number'
          - include: '#init-predicate-other'

  init-predicate-other:
    patterns:
      - begin: '\(\s*((?:\w|-)+)'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#pddl-expr'
          - include: '#number'
          - include: '#init-predicate'

  applied-predicate-other:
    patterns:
      - begin: '\(\s*((?:\w|-)+)'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#variable'
          - include: '#pddl-expr'
          - include: '#applied-predicate'

  applied-predicate:
    patterns:
      - begin: '\(\s*((?:\w|-)+)'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#variable'
          - include: '#pddl-expr'
          - include: '#applied-predicate-other'


  function:
    patterns:
      - begin: '\(\s*((?:\w|-)+)'
        end: '(\)\s+-\s+((?:\w|-)+))'
        endCaptures:
          '2': {name: storage.type.pddl}
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#variable'
          - name: meta.name.function.pddl
            captures:
              '1': {name: entity.name.function.pddl}
            match: '-\s+((?:\w|-)+)'


  function-with-either:
    patterns:
      - begin: '\((\w+)'
        end: '(\)\s+-\s+((?:\w|-)+))|\)'
        endCaptures:
          '2': {name: storage.type.pddl}
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#variable'
          - name: meta.name.function.pddl
            captures:
              '1': {name: entity.name.function.pddl}
            match: '-\s+((?:\w|-)+)'

  predicates:
    patterns:
      - comment: "Predicates"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:predicates))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#predicate'
          - include: '#any-sexpr'


  connected-predicate-other:
    patterns:
      - comment: "Predicates that are connected via and, or, etc."
        #name: string.unquoted.pddl # TODO: NAME
        begin: '\((and|or|eq|neq|not|=|&gt;=|&lt;=|assign|increase|decrease|scale-up|scale-down|forall|exists|imply|when|\+|-|\*|/)\b'
        end: '\)'
        beginCaptures:
          '1': {name: string.unquoted.pddl}
        patterns:
          - include: '#typed-variable-list'
          - include: '#connected-predicate'
          - include: '#applied-predicate'
          - include: '#variable'
          - include: '#pddl-expr'

  connected-predicate:
    patterns:
      - comment: "Predicates that are connected via and, or, etc."
        name: meta.type.pddl # TODO: NAME
        begin: '\((and|or|eq|neq|not|=|&gt;=|&lt;=|assign|increase|decrease|scale-up|scale-down|forall|exists|imply|when|\+|-|\*|/)\b'
        end: '\)'
        beginCaptures:
          '1': {name: string.unquoted.pddl}
        patterns:
          - include: '#typed-variable-list'
          - include: '#connected-predicate-other'
          - include: '#applied-predicate'
          - include: '#variable'
          - include: '#pddl-expr'

# TODO:
  functions:
    patterns:
      - comment: "Functions"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:functions))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#function'
          - begin: '\((either)'
            beginCaptures:      
              '1': {name: entity.name.function.pddl}
              '2': {name: storage.type.pddl}
            patterns:
              - include: '#pddl-expr'
            end: '\)'
         #- include: '#function-with-either'

  either:
    patterns:
      - begin: '(-)\s+\((either)'
        beginCaptures:      
          '1': {name: entity.name.function.pddl}
          '2': {name: storage.type.pddl}
        patterns:
          - include: '#pddl-expr'
        end: '\)'

  new-functions:
    patterns:
      - comment: "Functions"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:functions))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#either'
          - include: '#predicate'
          - include: '#pddl-expr'

  typed-variable-list:
    patterns:
      - begin: '\((\?((?:\w|-)+))'
        end: '\)'
        beginCaptures:
          '1': {name: keyword.other.pddl}
        patterns:
          - include: '#variable'
          - name: meta.name.function.pddl
            captures:
              '1': {name: constant.character.pddl}
              '2': {name: entity.name.function.pddl}
            match: '(-)(?:^|\s+)([a-zA-Z](?:\w|-|_)*)(?!:|\?)\b'

  precondition:
    patterns:
      - name: entity.name.function.pddl
        begin: ':precondition\s*'
        end: \b

 # any-sexpr:
 #   patterns:
 #     - match: \(.*\)
 #       patterns:
 #         - include: '$self'


  any-sexpr:
    patterns:
      - begin: '\('
        end: '\)'
        patterns:
          - include: '#any-sexpr-other'
          - match:  (?:\s)*

  any-sexpr-other:
    patterns:
      - begin: '\('
        end: '\)'
        patterns:
          - include: '#any-sexpr'
          - match: (?:\s)*

  action:
    patterns:
      - comment: "Action"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:action))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#connected-predicate'
          - include: '#applied-predicate'
          - include: '#pddl-expr'
          - include: '#comment'
          - include: '#typed-variable-list'
          - include: '#action-keyword'
          - include: '#built-in-var'
          - include: '#any-sexpr'

  durative-action:
    patterns:
      - comment: "Durative Action"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:durative-action))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#connected-predicate'
          - include: '#applied-predicate'
          - include: '#pddl-expr'
          - include: '#comment'
          - include: '#typed-variable-list'
          - include: '#durativ-action-keyword'
          - include: '#built-in-var'
          - include: '#any-sexpr'

#######################
### Problem Helpers ###
#######################

  problem-name-in-define:
    patterns:
      - comment: "Domain name in problem file"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(problem))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#comment'
          - name: invalid.illegal.pddl
            match: (\s+(?:\w|-)+){2,}
          - include: '#pddl-expr'

  domain-name-in-problem:
    patterns:
      - comment: "Domain name in problem file"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:domain))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#comment'
          - name: invalid.illegal.pddl
            match: (\s+(?:\w|-)+){2,}
          - include: '#pddl-expr'

##############################
### Problem specifications ###
##############################


  problem:  
    patterns:
    - comment: "problem definition"
      name: meta.function.pddl
      begin: '\(\s*((?i:define))\b'
      beginCaptures:
        '1': {name: storage.type.function-type.pddl}
      end: '\)' # Paren after the domain/problem name.
      patterns: 
        - include: '#comment'
        - include: '#problem-name-in-define'
        - include: '#domain-name-in-problem'
        - include: '#inits'
        - include: '#objects'
        - include: '#goal'

  objects:
    patterns:
      - comment: "Objects"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:objects))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - name: meta.keyword.pddl
            captures:
              '1': {name: entity.name.function.pddl}
              #'1': {name: string.unquoted.pddl}
              '2': {name: entity.name.tag.pddl}
            match:  (-)(?:^|\s+)([a-zA-Z](?:\w|-|_)*)
          - include: '#either'
          - include: '#pddl-expr'

  inits:
    patterns:
      - comment: "Initalized predicates"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:init))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#init-predicate'
          - include: '#connected-predicate'
          - include: '#any-sexpr'

  goal:
    patterns:
      - comment: "Goal"
        name: meta.type.pddl # TODO: NAME
        begin: '\(\s*(?i:(:goal))\b'
        end: '\)'
        beginCaptures:
          '1': {name: storage.type.pddl}
        patterns:
          - include: '#connected-predicate'
          - include: '#applied-predicate'
          - include: '#comment'
          - include: '#any-sexpr'


# TODO: Metric
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Volker Strobel</p>
<p class="date">Created: 2014-03-14 Fri 00:20</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.5h)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
